# **1.8.Soma_neurites**

The **1.8.Soma_neurites** workflow produces an instance segmentation of the **soma** and of the **neurites** from pre-segmented cell_masks for fluorescence confocal microscopy images. Using the workflow steps, you can adjust the parameters described below to change the method and mask for your segmentation.

⚠️ Make sure that the first character of the microscopy image layer name is not numeric

## EXTRACTION


### **1.8.1 | Extraction of the cellmask**

In this step, select whether the input image is a multichannel image (contains multiple masks i.e. cellmask and nuclei mask) or is simply the mask image, and select the channel of the cellmask.

Parameter:

-   `multichannel_input`: a true/false statement of whether the input image contains multiple masks
-	`chan`: the index of the cellmask channel, only utilized if `multichannel_input` is true

## PREPROCESSING


### **1.8.2 | Calculate radii of cell(s)**

This first rescales the input image to half its original size to increase speed of the workflow and reduce memory usage. Afterwards, it will search through a list of possible radii for the soma of each cell, and save the determined value to that of the label of the cell.

Parameters:

-	`method`: the method for determining the radius; binary and isotropic methods are available.

❗ If the method is chosen as binary, the radius of the erosion and dilation footprint will be variable between z-levels whereas if the method is chosen as isotropic, the erosion and dilation footprint will be treated as spheres. Binary tends to lead to oversegmentation of the soma whereas isotropic tends to lead to oversegmentation of the neurites as a result.

## CORE


### **1.8.3 | Segment initial soma mask**

This step utilizes the radii for each cell determined in the prior step, and applies the erosion and dilation steps with it on the full-scale image.

Parameters:

- `method`: the method for determining the radius; binary and isotropic methods are available.

❗ For best segmentation, use the same method as was used in the previous step.

### **1.8.4 | Segment initial neurite mask**

This step removes the regions from the original cell mask that remain after the initial soma mask segmentation, then applies a size filter to remove objects below a certain size (determined by the radius of each cell) to find an initial neurite segmentation.

Parameters:

- `method`: the method for determining the radius; binary and isotropic methods are available.

❗ For best segmentation, use the same method as was used in the previous step.

## POSTPROCESSING


### **1.8.5 | Clean soma mask**

Here, the areas in the initial neurite mask are removed from the original cell mask to leave only the smaller areas that were filtered out in the previous step, in addition to the soma of the cell. Next, areas not directly connected to the soma are once again removed from the finalized soma mask.

### **1.8.6 | Clean neurite mask**

Here, the areas in the finalized and cleaned soma mask are removed from the original cell mask to leave only the neurites and any smaller areas that were previously filtered out that are not directly connected to the soma. The remaining neurites are then labeled.

## POSTPOSTPROCESSING


### **1.8.7 | Stack masks**

The final step stacks the soma and neurite masks into one soma_neurite multi-channel mask image for export.

### The soma & neurite segmentation workflow is now complete. The final layer can be saved using File > Save.

### Batch processing: If you wish to utilize these settings on more than one image, or revisit the settings later, use the *“Save Workflow”* button at the bottom of the workflow editor. Be sure the settings file ends in *“soma_neurites”*.
